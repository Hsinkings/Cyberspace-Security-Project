# SM4性能测试使用说明

## 快速开始

### 1. 确保环境准备
- 已安装Python 3.6或更高版本
- 已编译SM4_Basic和SM4_AESNI项目

### 2. 运行测试

#### 方法1: 使用批处理文件（推荐）
```bash
run_test.bat
```
然后选择测试类型：
- 1: 快速测试（单次加密，最快）
- 2: 简单测试（多次测试取平均值）
- 3: 完整测试（所有功能）

#### 方法2: 直接运行Python脚本
```bash
# 快速测试
python quick_test.py

# 简单测试
python simple_test.py

# 完整测试
python sm4_performance_test.py
```

## 测试说明

### 快速测试 (quick_test.py)
- 测试100KB数据的单次加密时间
- 输出加密时间和吞吐量
- 适合快速验证程序是否正常工作

### 简单测试 (simple_test.py)
- 测试1KB、10KB、100KB、1MB数据的加密性能
- 每个大小测试5次取平均值
- 输出详细的性能数据表格

### 完整测试 (sm4_performance_test.py)
- 包含所有测试功能
- 测试单块加密性能
- 测试文件加密性能
- 提供最全面的性能分析

## 输出示例

```
快速SM4加密时间测试
===================

=== 基本SM4加密测试 ===
测试程序: ../SM4_Basic/x64/Debug/SM4_Basic.exe
数据大小: 102400 字节 (100KB)
加密时间: 15.23ms
吞吐量: 6.57MB/s
加密成功

=== AESNI优化SM4加密测试 ===
测试程序: ../SM4_AESNI/x64/Debug/SM4_AESNI.exe
数据大小: 102400 字节 (100KB)
加密时间: 8.45ms
吞吐量: 11.83MB/s
加密成功

测试完成！
```

## 故障排除

### 1. 找不到Python
```
错误: 找不到Python，请确保已安装Python 3.6或更高版本
```
**解决方案**: 安装Python 3.6或更高版本

### 2. 找不到SM4程序
```
错误: 找不到基本SM4程序 ../SM4_Basic/x64/Debug/SM4_Basic.exe
请先编译SM4_Basic项目
```
**解决方案**: 
1. 打开Visual Studio
2. 编译SM4_Basic项目
3. 确保生成了exe文件

### 3. 测试超时
```
测试 1: 超时
```
**解决方案**: 
- 检查程序是否正常运行
- 尝试使用较小的测试数据
- 检查系统资源使用情况

### 4. 加密失败
```
加密失败: 程序返回非零退出码
```
**解决方案**:
- 检查输入文件格式
- 确保密钥文件为16字节
- 检查程序参数是否正确

## 性能分析

### 正常性能范围
- **基本SM4**: 5-15 MB/s
- **AESNI优化**: 15-30 MB/s

### 性能影响因素
1. **CPU性能**: 更快的CPU通常有更好的性能
2. **AESNI支持**: 支持AESNI指令集的CPU性能更好
3. **数据大小**: 大数据块通常有更好的吞吐量
4. **系统负载**: 高系统负载会影响性能

### 优化建议
1. 使用Release模式编译程序
2. 关闭其他占用CPU的程序
3. 使用支持AESNI的CPU
4. 测试时使用较大的数据块 