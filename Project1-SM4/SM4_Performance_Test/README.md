# SM4加密性能测试程序

这个程序用于测试SM4加密算法的性能，包括基本实现和AESNI优化版本的性能对比。

## 功能特性

- **多种数据大小测试**: 测试1KB、10KB、100KB、1MB不同大小的数据加密性能
- **多次测试取平均值**: 每个数据大小测试5次，取平均用时
- **性能指标**: 输出加密用时和吞吐量(MB/s)
- **对比测试**: 同时测试基本SM4实现和AESNI优化版本
- **文件加密测试**: 测试实际文件加密的性能

## 测试内容

1. **基本SM4加密性能测试**
   - 测试标准SM4实现的加密性能
   - 分块处理数据，逐块加密

2. **AESNI优化SM4加密性能测试**
   - 测试使用AESNI指令集优化的SM4实现
   - 利用SIMD指令进行并行处理

3. **文件加密性能测试**
   - 测试实际文件加密的性能
   - 包含文件I/O操作的时间

## 编译和运行

### 编译要求
- Visual Studio 2019或更高版本
- 支持AESNI指令集的CPU（用于AESNI优化测试）

### 编译步骤
1. 打开`SM4_Performance_Test.sln`解决方案文件
2. 选择Release配置和x64平台
3. 编译项目

### 运行程序
```bash
# 直接运行编译后的exe文件
SM4_Performance_Test.exe
```

## 输出说明

程序会输出以下信息：

```
SM4加密性能测试程序
====================

=== 基本SM4加密性能测试 ===
  数据大小    平均用时(ms)     吞吐量(MB/s)
--------------------------------------------------
      1KB           0.12         8.33
     10KB           1.15         8.70
    100KB          11.45         8.73
   1024KB         114.67         8.93

=== AESNI优化SM4加密性能测试 ===
  数据大小    平均用时(ms)     吞吐量(MB/s)
--------------------------------------------------
      1KB           0.05        20.00
     10KB           0.48        20.83
    100KB           4.78        20.92
   1024KB          47.85        21.40

=== 文件加密性能测试 ===
基本SM4文件加密:
  文件大小: 100KB
  加密用时: 15.23ms
  吞吐量: 6.57MB/s

AESNI优化SM4文件加密:
  文件大小: 100KB
  加密用时: 8.45ms
  吞吐量: 11.83MB/s
```

## 性能分析

- **数据大小影响**: 数据越大，加密时间越长，但吞吐量相对稳定
- **AESNI优化效果**: AESNI优化版本通常比基本实现快2-3倍
- **文件I/O开销**: 文件加密包含I/O操作，实际性能可能低于内存测试

## 注意事项

1. 测试结果会因硬件配置而异
2. 确保CPU支持AESNI指令集以获得最佳性能
3. 测试过程中会创建临时文件，程序结束时会自动清理
4. 建议在Release模式下运行以获得最佳性能

## 使用方法

### 方法1: 使用Python脚本（推荐）

1. 确保已安装Python 3.6或更高版本
2. 确保已编译SM4_Basic和SM4_AESNI项目
3. 运行测试：
   ```bash
   # 方法1: 直接运行Python脚本
   python simple_test.py
   
   # 方法2: 使用批处理文件
   run_test.bat
   ```

### 方法2: 使用C++程序

1. 打开`SM4_Performance_Test.sln`解决方案文件
2. 选择Release配置和x64平台
3. 编译项目
4. 运行编译后的exe文件

## 文件结构

```
SM4_Performance_Test/
├── simple_test.py              # 简单Python测试脚本（推荐）
├── sm4_performance_test.py     # 完整Python测试脚本
├── run_test.bat               # 运行Python测试的批处理文件
├── main.cpp                   # C++测试程序
├── SM4_Performance_Test.vcxproj # Visual Studio项目文件
├── SM4_Performance_Test.sln   # 解决方案文件
└── README.md                  # 说明文档
``` 